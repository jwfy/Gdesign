<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DMovie | 找回密码</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/theme.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="register-page">
<style type="text/css">
    .fa:before, .fa-user {
        display: block;
        line-height: 34px;
    }
</style>
<div class="register-box">
    <div class="register-logo">
        <a href="/user/user/login"><b>Dmovie </b>Admin</a>
    </div>
    <div class="register-box-body">
        <p class="login-box-msg">找回密码</p>
        <form>
            {% set ans = pyobject.get('result') %}
            <input type="hidden" name="q" value="dm"/>
            <input type="hidden" name="session" value="{{ ans.get('session') }}"/>
            <input type="hidden" name="id" value="{{ ans.get('id') }}" />
            <div class="form-group has-feedback">
                <input type="password" class="form-control" placeholder="新密码" name="password" id="password"/>
                <span class="form-control-feedback fa fa-lock"></span>
            </div>
            <div class="form-group has-feedback">
                <input type="password" class="form-control" placeholder="再次输入新密码" name="password-again" id="password-again"/>
                <span class="form-control-feedback fa fa-sign-in"></span>
            </div>
            <div class="row">
                <div class="col-xs-8">
                </div>
                <div class="col-xs-4">
                    <button type="button" class="btn btn-primary btn-block btn-flat passwd">提交</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="/static/js/jquery-1.9.1.js"></script>
<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
<script>
    $(function () {
        $(".passwd").click(function(){
            var session = $("input[name='session']").val();
            var id = $("input[name='id']").val();
            var password = $("#password").val();
            var password_again = $("#password-again").val();
            var q = $("input[name='q']").val();

            if(!password){
                $("#password").focus().selected();
                return false;
            }
            if(!password_again){
                $("#password-again").focus().selected();
                return false;
            }
            if(!(password_again == password)){
                alert("两次输入的密码不想同")
                $("#password-again").focus().selected();
                return false;
            }
            $.ajax({
                type:"post",
                url:"/user/user/find_passwd",
                data:{"password":password, "q":q, "id":id, "session":session},
                dataType: "json" ,
                success: function(data){
                    console.log(data);
                    if(data["status"] == "success"){
                        window.location.href = "/user/user/login";
                    }
                    else {
                        alert(data["query"]);
                    }
                },
                error:function(data, status, e){
                    alert(e);
                }
            });
            return false;
        });
    });
</script>
</body>
</html>