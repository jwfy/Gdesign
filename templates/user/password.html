<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DMovie | 修改密码</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/theme.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="register-page">
<style type="text/css">
    .fa:before, .fa-user {
        display: block;
        line-height: 34px;
    }
</style>
<div class="register-box">
    <div class="register-logo">
        <a href="/user/user/login"><b>Dmovie </b>Admin</a>
    </div>

    <div class="register-box-body">
        <p class="login-box-msg">修改密码</p>
        <form>
            <div class="form-group has-feedback">
                <input type="hidden" name="q" value="dm"/>
                <input type="text" class="form-control" placeholder="用户名" name="name" id="name"/>
                <span class="form-control-feedback fa fa-user"></span>
            </div>
            <div class="form-group has-feedback">
                <input type="text" class="form-control" placeholder="邮箱地址" name="email" id="email"/>
                <span class="form-control-feedback fa fa-envelope"></span>
            </div>
            <div class="form-group has-feedback">
                <input type="password" class="form-control" placeholder="密码" name="password" id="password"/>
                <span class="form-control-feedback fa fa-lock"></span>
            </div>
            <div class="form-group has-feedback">
                <input type="password" class="form-control" placeholder="新密码" name="password-again" id="password-again"/>
                <span class="form-control-feedback fa fa-sign-in"></span>
            </div>
            <div class="row">
                <div class="col-xs-8">
                </div>
                <div class="col-xs-4">
                    <button type="button" class="btn btn-primary btn-block btn-flat passwd">提交</button>
                </div>
            </div>
        </form>
        <a href="/user/user/login" class="text-center">登录</a>
        <a href="/user/user/register" class="text-center">注册</a>
    </div>
</div>

<script src="/static/js/jquery-1.9.1.js"></script>
<script src="/static/js/bootstrap.min.js" type="text/javascript"></script>
<script>
    $(function () {
        $(".passwd").click(function(){
            var name = $("#name").val();
            var email = $("#email").val();
            var password = $("#password").val();
            var password_again = $("#password-again").val();
            var q = $("input[name='q']").val();
            if(!name){
                $("#name").focus().selected();
                return false;
            }
            if(!email){
                $("#email").focus().selected();
                return false;
            }
            if(!password){
                $("#password").focus().selected();
                return false;
            }
            if(!password_again){
                $("#password-again").focus().selected();
                return false;
            }
            var re_pa = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
            if(!re_pa.test(email)){
                alert("输入正确的邮箱地址");
                $("#email").focus().selected();
                return false;
            }
            if(password_again == password){
                alert("请输入新密码")
                $("#password-again").focus().selected();
                return false;
            }
            if(name.length > 10){
                alert("用户名称长度过长");
                $("#name").focus().selected();
                return false;
            }
            $.ajax({
                type:"post",
                url:"/user/user/update_password",
                data:{"name":name, "email":email, "old_password":password, "new_password":password_again, "q":q},
                dataType: "json" ,
                success: function(data){
                    console.log(data);
                    if(data["status"] == "success"){
                        window.location.href = "/user/user/login";
                    }
                    else {
                        alert(data["query"]);
                    }
                },
                error:function(data, status, e){
                    alert(e);
                }
            });
            return false;
        });
    });
</script>
</body>
</html>