{% extends 'base.html' %}
{% block css %}<link href="/static/css/webuploader.css" rel="stylesheet" type="text/css"/>{% end %}
{% block active3 %}active{% end %}
{% block title %}电影列表{% end block %}
{% block content-head %}电影列表{% end block %}
{% block content %}
{% set ans = pyobject.get('result') %}
{% set query = ans.get('query') %}
{% set q = ans.get('q', '') %}
{% set r_category = ans.get('category', '') %}
{% set r_director = ans.get('directors', '') %}
{% set cast = ans.get('casts', '') %}
{% set url = '/main/movie/list?' %}
<div class="row">
    <div class="col-md-12">
        <div class="box box-primary">
            <div class="box-header">
                <h3 class="box-title">电影列表{% if q %}-搜索-{{ q }}{% end %}</h3>
            </div>
            <div class="box-body">
                <div class="row" style="margin-bottom: 10px">
                    <div class="col-xs-6">
                        <button class="btn btn-default btn-sm checkbox-toggle" title="全选/全不选"><i class="fa fa-square-o">选择</i></button>
                        <div class="btn-group">
                            <button class="btn btn-default btn-sm iremove" title="下线"><i class="fa fa-remove">下线</i></button>
                            <button class="btn btn-default btn-sm inormal" title="上线"><i class="fa fa-check">上线</i></button>
                        </div>
                    </div>
                    <form class="col-xs-3" style="float: right" role="search" method="post" action="/main/movie/list">
                        <div class="has-feedback">
                            <input type="text" class="form-control input-sm" name="q" placeholder="查找电影"/>
                            <input type="hidden" name="csrf_code" value="1234"/>
                            <span class="fa fa-search form-control-feedback"></span>
                        </div>
                    </form>
                </div>
                <table class="table table-hover removie-table">
                    <thead>
                    {% include movie/head.html %}
                    </thead>
                    <tbody>
                    {% if type(query) == list %}
                    {% for qe in query %}
                        {% include movie/body.html %}
                    {% end %}
                    {% end %}
                    </tbody>
                </table>
                {% set url = '/main/movie/list?' %}
                {% if r_director %}
                    {% set url = url + 'directors=%s' %(r_director) %}
                {% end %}
                {% if cast %}
                    {% set url = url + '&casts=%s' %(cast) %}
                {% end %}
                {% if r_category %}
                    {% set url = url + '&category=%s' %(r_category) %}
                {% end %}
                {% if q %}
                {% set url = url + '&q=%s' %(q) %}
                {% end %}
                {% set url = url + "&page_num=%s" %}
                {% include page.html %}
            </div>
        </div>
    </div>
</div>
{% end %}
{% block js %}
<script>
    $(function () {
        $(".inormal").click(function(){
            var ids = icheck_function($(".removie-table"));
            var status = "online";
            ajax_status(ids, status);
        });
        $(".iremove").click(function(){
            var ids = icheck_function($(".removie-table"));
            var status = "offline";
            ajax_status(ids, status);
        });
        function ajax_status(ids, status){
            debugger;
            $.ajax({
                url:"/main/movie/update_status",
                data:{"_ids":JSON.stringify(ids), "status":status},
                dataType: "json" ,
                success: function(data){
                    console.log(data);
                    if(data["status"] == "success"){
                        window.location.href="/main/movie/list";
                    }
                    else
                        alert(data["query"]);
                },
                error:function(data, status, e){
                    alert(e);
                }
            });
            return false;
        }
    });

</script>
{% end %}