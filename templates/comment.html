{% extends 'base.html' %}
{% block active5 %}active{% end %}
{% block title %}评论{% end block %}
{% block content-head %}评论{% end block %}
{% block content %}
{% set ans = pyobject.get('result') %}
{% set query = ans.get('query') %}
{% set r_status = ans.get('r_status', 0) %}
{% set category = ans.get('category', 'movie') %}
{% set contain = ans.get('contain', '') %}
<div class="row">
    <div class="col-md-12">
        <div class="box box-primary">
            <div class="box-header">
                <h3 class="box-title">评论-{{ ans.get('category','') }}{% if contain %}-搜索-{{ contain }}{% end %}</h3>
            </div>
            <div class="box-body">
                <div class="row" style="margin-bottom: 10px">
                    <div class="col-xs-6">
                        <button class="btn btn-default btn-sm checkbox-toggle" title="全选/全不选"><i class="fa fa-square-o">选择</i></button>
                        <div class="btn-group">
                            <button class="btn btn-default btn-sm ihidden" title="隐藏"><i class="fa fa-ban"></i>隐藏</button>
                            <button class="btn btn-default btn-sm iremove" title="删除"><i class="fa fa-remove">删除</i></button>
                            <button class="btn btn-default btn-sm inormal" title="正常"><i class="fa fa-check">正常</i></button>
                            <!--
                            <button class="btn btn-default btn-sm iadd" title="添加评论"><i class="fa fa-plus"></i></button>
                            -->
                        </div>
                    </div>
                    <form class="col-xs-3" style="float: right" role="search" method="post" action="/comment/comment/list">
                        <div class="has-feedback">
                            <input type="hidden" name="category" value="{{ category}}" />
                            <input type="hidden" name="status" value="{{ r_status }}"/>
                            <input type="text" class="form-control input-sm" name="contain" placeholder="查找评论"/>
                            <span class="fa fa-search form-control-feedback"></span>
                        </div>
                    </form>
                </div>
                <table class="table table-hover comment-table">
                    <thead>
                        {% include comment/head.html %}
                    </thead>
                    <tbody>
                        {% if type(query) == list %}
                            {% for q in query %}
                                {% include comment/body.html %}
                            {% end %}
                        {% end %}
                    </tbody>
                </table>
                {% set url = '/comment/comment/list?category=%s&status=%s' %(category, r_status) %}
                {% if contain %}
                    {% set url = url + '&contain=%s' %(contain) %}
                {% end %}
                {% set url = url + "&page_num=%s" %}
                {% include page.html %}
            </div>
        </div>
    </div>
    <div class="col-md-6 comment-box hidden">
        {% include comment/add.html %}
    </div>
</div>
{% end %}

{% block js %}
<script>
    $(function () {
        $(".inormal").click(function(){
            var ids = icheck_function($(".comment-table"));
            if(ids.length <= 0){
                alert("未选中所选项");
                return false;
            }
            var status = 1;
            ajax_status(ids, status);
        });
        $(".iremove").click(function(){
            var ids = icheck_function($(".comment-table"));
            if(ids.length <= 0){
                alert("未选中所选项");
                return false;
            }
            var status = 2;
            ajax_status(ids, status);
        });

        $(".ihidden").click(function(){
            var ids = icheck_function($(".comment-table"));
            if(ids.length <= 0){
                alert("未选中所选项");
                return false;
            }
            var status = 3;
            ajax_status(ids, status);
        });
        function ajax_status(ids, status){
            $.ajax({
                url:"/comment/comment/update_status",
                data:{"ids":JSON.stringify(ids), "status":status},
                dataType: "json" ,
                success: function(data){
                    console.log(data);
                    if(data["status"] == "success"){
                        window.location.href="/comment/comment/list";
                    }
                    else
                        alert(data["query"]);
                },
                error:function(data, status, e){
                    alert(e);
                }
            });
            return false;
        }
        /*
        $(".iadd").click(function(){
            $(".comment-box").removeClass("hidden");
        })
        */
        $(".nickname").click(function(){
            var id = $(this).data("_id");
            var title = $(this).data("title");
            //console.log(id);
            $(".comment-box").removeClass("hidden");
            var _this = $(".comment-form", ".comment-box");
            $(_this).find("input[name='_id']").val(id);
            $(_this).find("input[name='title']").val(title);
            $(_this).find("input[name='name']").val("jwfy");
            $(_this).find("input[name='email']").val("jwfy0902@foxmail.com");
        });
        $(".comment-close").click(function(){
            $(".comment-box").addClass("hidden");
        })

    });
</script>
{% end %}