{% extends 'base.html' %}
{% block active2 %}active{% end %}
{% block title %}电影推荐{% end block %}
{% block content-head %}电影推荐{% end block %}
{% block content %}
{% set ans = pyobject.get('result') %}
{% set query = ans.get('query') %}
{% set r_status = ans.get('r_status', 0) %}
{% set title = ans.get('title', '') %}
<div class="row">
    <div class="col-md-12">
        <div class="box box-primary">
            <div class="box-header">
                <h3 class="box-title">首页电影推荐{% if title %}-搜索-{{ title }}{% end %}</h3>
            </div>
            <div class="box-body">
                <div class="row" style="margin-bottom: 10px">
                    <div class="col-xs-6">
                        <button class="btn btn-default btn-sm checkbox-toggle" title="全选/全不选"><i class="fa fa-square-o">选择</i></button>
                        <div class="btn-group">
                            <button class="btn btn-default btn-sm iremove" title="下线"><i class="fa fa-remove">上线</i></button>
                            <button class="btn btn-default btn-sm inormal" title="上线"><i class="fa fa-check">下线</i></button>
                        </div>
                    </div>
                    <form class="col-xs-3" style="float: right" role="search" method="post" action="/main/re/list">
                        <div class="has-feedback">
                            <input type="hidden" name="status" value="{{ r_status }}"/>
                            <input type="text" class="form-control input-sm" name="contain" placeholder="查找评论"/>
                            <span class="fa fa-search form-control-feedback"></span>
                        </div>
                    </form>
                </div>
                <table class="table table-hover removie-table">
                    <thead>
                    {% include removie/head.html %}
                    </thead>
                    <tbody>
                    {% if type(query) == list %}
                    {% for q in query %}
                    {% include removie/body.html %}
                    {% end %}
                    {% end %}
                    </tbody>
                </table>
                {% set url = '/main/re/list?status=%s' %(r_status) %}
                {% if title %}
                {% set url = url + '&title=%s' %(title) %}
                {% end %}
                {% set url = url + "&page_num=%s" %}
                {% include page.html %}
            </div>
        </div>
    </div>
    <div class="col-md-6 comment-box hidden">
    </div>
</div>
{% end %}

{% block js %}
<script>
    $(function () {
        $(".inormal").click(function(){
            var ids = icheck_function($(".removie-table"));
            var status = 1;
            ajax_status(ids, status);
        });
        $(".iremove").click(function(){
            var ids = icheck_function($(".removie-table"));
            var status = 2;
            ajax_status(ids, status);
        });
        function ajax_status(ids, status){
            $.ajax({
                url:"/main/re/update_status",
                data:{"ids":JSON.stringify(ids), "status":status},
                dataType: "json" ,
                success: function(data){
                    console.log(data);
                    if(data["status"] == "success"){
                        window.location.href="/main/re/list";
                    }
                    else
                        alert(data["query"]);
                },
                error:function(data, status, e){
                    alert(e);
                }
            });
            return false;
        }
    });
</script>
{% end %}